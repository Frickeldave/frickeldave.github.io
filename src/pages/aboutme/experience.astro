---
import type { PortfolioEntry } from "@/types";
import AboutMeLayout from "@components/aboutme/AboutMeLayout.astro";
import { getIndex } from "@lib/contentParser";

const entry = (await getIndex("aboutme")) as PortfolioEntry;
const { experience, skills } = entry.data;

const toc = [];
if (skills) toc.push({ text: "Skills", slug: "skills", depth: 2 });
if (experience) {
  experience.forEach((job, index) => {
    // Creating slug from position + company
    const slug = `job-${index}`;
    toc.push({ text: `${job.position} @ ${job.company}`, slug, depth: 2 });
  });
}
---

<AboutMeLayout title="Experience" description="My professional experience and skills" toc={toc}>
  <div class="glass mb-6 rounded-lg p-6 lg:p-8">
    <h1 class="text-txt-h dark:text-darkmode-txt-h mb-4 text-3xl font-bold lg:text-4xl">
      Skills & Experience
    </h1>
  </div>
  
  <!-- Skills Section -->
  {skills && (
    <div id="skills" class="glass mb-6 rounded-lg p-6 lg:p-8">
       <h2 class="text-txt-h dark:text-darkmode-txt-h mb-4 text-2xl font-bold">Skills</h2>
       <div class="grid gap-6 md:grid-cols-2">
         {skills.map((skillGroup) => (
           <div>
             <h3 class="text-txt-h dark:text-darkmode-txt-h mb-2 text-lg font-semibold">{skillGroup.category}</h3>
             <div class="flex flex-wrap gap-2">
               {skillGroup.technologies.map((tech) => (
                 <span class="rounded-full bg-amber-500/20 px-3 py-1 text-xs font-medium text-amber-700 dark:text-amber-300">
                   {tech}
                 </span>
               ))}
             </div>
           </div>
         ))}
       </div>
    </div>
  )}

  <!-- Experience Section -->
  {experience && (
    <div class="space-y-6">
      {experience.map((job, index) => (
        <div id={`job-${index}`} class="glass rounded-lg p-6 lg:p-8">
          <div class="mb-2 flex flex-wrap items-baseline justify-between gap-2">
            <h2 class="text-txt-h dark:text-darkmode-txt-h text-xl font-bold">{job.position}</h2>
            <span class="text-sm text-gray-500 dark:text-gray-400">{job.period}</span>
          </div>
          <p class="text-lg font-semibold text-amber-600 dark:text-amber-400 mb-4">{job.company}</p>
          
          {job.responsibilities && (
            <ul class="list-disc pl-5 space-y-2 text-txt-p dark:text-darkmode-txt-p">
              {job.responsibilities.map((resp) => (
                <li>{resp}</li>
              ))}
            </ul>
          )}
        </div>
      ))}
    </div>
  )}
</AboutMeLayout>
