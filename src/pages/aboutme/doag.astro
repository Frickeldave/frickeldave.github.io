---
import AboutMeLayout from "@components/aboutme/AboutMeLayout.astro";
import { getEntry } from "astro:content";
import { markdownify } from "@lib/textConverter";

const doagEntry = await getEntry("aboutme", "doag");

if (!doagEntry) {
  throw new Error("DOAG entry not found");
}

const episodes = doagEntry.data.episodes || [];
const podcastPlatforms = doagEntry.data.podcast_platforms || [];

const toc = episodes.map((episode) => ({
  text: episode.title,
  slug: episode.id,
  depth: 2,
}));
---

<AboutMeLayout
  title="DOAG & DOAG Voices"
  description="Meine Aktivit√§ten bei der DOAG und als Co-Host des DOAG VOICES Podcasts"
  toc={toc}
>
  <section class="container p-4">
    <div class="glass mb-6 rounded-lg p-6 lg:p-8">
      <h1
        class="text-txt-h dark:text-darkmode-txt-h mb-4 text-3xl font-bold lg:text-4xl"
      >
        üéôÔ∏è DOAG Voices Podcast
      </h1>
      <div
        class="content prose-lg"
        set:html={typeof doagEntry.data.intro === "string"
          ? markdownify(doagEntry.data.intro, true)
          : doagEntry.data.intro?.content
            ? markdownify(doagEntry.data.intro.content, true)
            : ""}
      />
    </div>

    {
      doagEntry.data.podcast_intro && (
        <div class="glass mb-6 rounded-lg p-6 lg:p-8">
          <h2 class="text-txt-h dark:text-darkmode-txt-h mb-4 text-2xl font-bold">
            √úber den Podcast
          </h2>
          <div
            class="content prose-lg"
            set:html={markdownify(doagEntry.data.podcast_intro, true)}
          />

          {podcastPlatforms.length > 0 && (
            <div class="mt-6">
              <h3 class="text-txt-h dark:text-darkmode-txt-h mb-3 text-lg font-semibold">
                Jetzt anh√∂ren auf:
              </h3>
              <div class="flex flex-wrap gap-2">
                {podcastPlatforms.map((platform) => {
                  let bg;
                  if (platform.name === "Spotify") bg = "#1DB954";
                  else if (platform.name === "Apple Podcasts") bg = "#FA57C2";
                  else if (platform.name === "Amazon Music") bg = "#FF9900";
                  else if (platform.name === "Deezer") bg = "#ED311B";
                  else if (platform.name === "Podcast.de") bg = "#0066CC";
                  else if (platform.name === "Acast") bg = "#000000";
                  else bg = "#777777";
                  return (
                    <a
                      href={platform.url}
                      target="_blank"
                      rel="noopener"
                      class="inline-block rounded px-2.5 py-0.5 text-sm text-white transition-opacity hover:opacity-80"
                      style={{ backgroundColor: bg }}
                    >
                      {platform.name}
                    </a>
                  );
                })}
              </div>
            </div>
          )}
        </div>
      )
    }

    {
      episodes.map((episode) => (
        <div
          id={episode.id}
          class="glass mb-6 scroll-mt-24 rounded-lg p-6 lg:p-8"
        >
          <h2 class="text-txt-h dark:text-darkmode-txt-h mb-2 text-2xl font-bold">
            {episode.title}
          </h2>
          <p class="mb-2 text-sm text-txt-p dark:text-darkmode-txt-p">
            <strong>{episode.edition}</strong> ‚Ä¢ {episode.date}
          </p>
          <p class="mb-4 text-txt-p dark:text-darkmode-txt-p">
            <strong>Mit:</strong> {episode.guests}
          </p>
          <div
            class="content mb-4"
            set:html={markdownify(episode.description, true)}
          />
          <div class="mt-2 flex gap-2">
            {Object.entries(episode.links ?? {}).map(([provider, url]) => {
              let bg;
              if (provider === "spotify") bg = "#1DB954";
              else if (provider === "apple") bg = "#FA57C2";
              else if (provider === "amazon") bg = "#FF9900";
              else if (provider === "deezer") bg = "#ED311B";
              else if (provider === "podcast_de") bg = "#0066CC";
              else if (provider === "acast") bg = "#000000";
              else bg = "#777777";
              const label =
                provider.charAt(0).toUpperCase() +
                provider.slice(1).replace("_", " ");
              return (
                <a
                  href={url}
                  target="_blank"
                  rel="noopener"
                  class="inline-block rounded px-2.5 py-0.5 text-sm text-white transition-opacity hover:opacity-80"
                  style={{ backgroundColor: bg }}
                >
                  {label}
                </a>
              );
            })}
          </div>
        </div>
      ))
    }
  </section>
</AboutMeLayout>
